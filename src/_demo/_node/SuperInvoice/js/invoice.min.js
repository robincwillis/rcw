var app=app||{models:{},collections:{},views:{}};app.models.Contact=Backbone.RelationalModel.extend({urlRoot:"/api/contacts/","default":{companyName:"",firstName:"",lastName:"",address:"",city:"",state:"",zip:"",country:"",phone:"",email:""},toJSON:function(){var a=Backbone.Model.prototype.toJSON.apply(this,arguments);return a.cid=this.cid,a},parse:function(a){return a.id=a._id,a}});var app=app||{models:{},collections:{},views:{}};app.models.Invoice=Backbone.RelationalModel.extend({relations:[{type:"HasOne",key:"employee",relatedModel:"app.models.Contact",autoFetch:!0},{type:"HasOne",key:"client",relatedModel:"app.models.Contact",autoFetch:!0}],"default":{title:"Untitled",date:"",dueDate:"",status:"",pref:"",total:0,subtotal:0,taxes:0},initialize:function(){_.bindAll(this,"updateTotal")},updateTotal:function(){this.attributes.total=0;var a=_.pluck(this.services.toJSON(),"cost");this.attributes.total+=_.reduce(a,function(a,b){return a+b},0),this.trigger("update:total")},parse:function(a){return a.id=a._id,a}});var app=app||{models:{},collections:{},views:{}};app.models.Service=Backbone.RelationalModel.extend({initialize:function(){_.bindAll(this,"updateCost"),this.updateCost()},"default":{description:"",rate:0,time:0,cost:0},updateCost:function(){console.log("updating cost"),this.attributes.cost=this.attributes.rate*this.attributes.time,this.trigger("update:cost")}});var app=app||{models:{},collections:{},views:{}};app.collections.Contacts=Backbone.Collection.extend({model:app.models.Contact,url:"/api/contacts"});var app=app||{models:{},collections:{},views:{}};app.collections.Invoices=Backbone.Collection.extend({model:app.models.Invoice,url:"/api/invoices"});var app=app||{models:{},collections:{},views:{}};app.collections.Services=Backbone.Collection.extend({model:app.models.Service,url:"/api/services"});var app=app||{models:{},collections:{},views:{}};app.views.Contact=Backbone.View.extend({tagName:"tr",template:invoice.Templates.contact_entry,events:{"click #edit-contact":"editContact","click #save-contact":"saveContact","click #delete-contact":"deleteContact"},initialize:function(){this.model.on("change",this.render,this)},render:function(){return this.$el.html(this.template(this.model.toJSON())),this},editContact:function(a){a.preventDefault();var b=invoice.Templates.contact_edit;this.$el.find("#edit-contact-container").html(b(this.model.toJSON()))},saveContact:function(a){a.preventDefault();var b={};$("#edit-contact-form").find("input").each(function(a,c){""!==$(c).val&&(b[c.id]=$(c).val())}),this.model.set(b),this.model.save()},deleteContact:function(a){a.preventDefault(),this.trigger("delete:contact",this.model)}});var app=app||{models:{},collections:{},views:{}};app.views.Contacts=Backbone.View.extend({el:"#contacts",template:invoice.Templates.contact_list,events:{"click #new-contact":"newContact","click #add-contact":"addContact"},initialize:function(){this.collection.on("add",this.render,this),this.collection.on("remove",this.render,this),this.collection.on("reset",this.render,this),this.collection.fetch({reset:!0})},render:function(){return this.$el.html(this.template()),this.collection.each(function(a){this.renderContact(a)},this),this},renderContact:function(a){var a=new app.views.Contact({model:a});this.listenTo(a,"delete:contact",this.deleteContact),this.$el.find("tbody").append(a.render().el)},newContact:function(a){a.preventDefault(),console.log("new contact");var b=invoice.Templates.contact_new;this.$el.find("#new-contact-container").html(b)},addContact:function(a){a.preventDefault();var b={};$("#add-contact-form").find("input").each(function(a,c){""!==$(c).val&&(b[c.id]=$(c).val())}),console.log(b);var c=new app.models.Contact(b);this.collection.create(c)},saveContact:function(){},deleteContact:function(a){this.collection.remove(a)}});var app=app||{models:{},collections:{},views:{}};app.views.Invoice=Backbone.View.extend({template:invoice.Templates.invoice_show,events:{"click #edit-invoice":"editInvoice","click #save-invoice":"saveInvoice","click #cancel-invoice":"cancelInvoice","click #close-invoice":"closeInvoice","click #new-service":"newService","click #add-service":"addService"},initialize:function(a){this.parent=a.parent,this.model.on("change",this.render,this),this.model.on("update:total",this.render,this)},renderTotal:function(){console.log("this is rending total")},render:function(){console.log("rendering");var a={invoice:this.model.toJSON(),client:this.model.client.toJSON(),employee:this.model.employee.toJSON()};return this.$el.html(this.template(a)),this.renderServices(),this},editInvoice:function(a){a.preventDefault(),this.$el.find("#invoice-info").hide();var b=invoice.Templates.invoice_edit,c={invoice:this.model.toJSON(),client:this.model.client.toJSON(),employee:this.model.employee.toJSON(),contacts:this.parent.contacts.toJSON()};this.$el.find("#edit-invoice-container").html(b(c)),this.$el.find(".datepicker").datepicker()},saveInvoice:function(a){a.preventDefault();var b={};$("#edit-invoice-form").find("input").each(function(a,c){""!==$(c).val&&(b[c.id]=$(c).val())}),b.status=$("#status").find(":selected").text();var c=$("#employeeId").find(":selected").val(),d=$("#clientId").find(":selected").val();console.log(d),this.model.employee=this.parent.contacts.get(c),this.model.client=this.parent.contacts.get(d),this.model.set(b),this.model.save(),console.log(this.model),this.$el.find("#edit-invoice-container").empty(),this.$el.find("#invoice-info").show()},cancelInvoice:function(){this.$el.find("#edit-invoice-container").empty(),this.$el.find("#invoice-info").show()},closeInvoice:function(){console.log("closing invoice"),this.trigger("show:invoices"),this.remove()},renderServices:function(){var a=new app.views.Services({collection:this.model.services});this.$el.find("#list-service-container").html(a.render().el)},newService:function(a){console.log("new service"),a.preventDefault();var b=invoice.Templates.service_new;this.$el.find("#new-service-container").html(b)},addService:function(a){a.preventDefault(),console.log("add service");var b={};$("#add-service-form").find("input").each(function(a,c){""!==$(c).val&&(b[c.id]=$(c).val())});var c=new app.models.Service(b);console.log(b),this.model.services.add(c),this.model.listenTo(c,"update:cost",this.model.updateTotal),c.updateCost(),this.$el.find("#new-service-container").empty()}});var app=app||{models:{},collections:{},views:{}};app.views.InvoiceEntry=Backbone.View.extend({tagName:"tr",template:invoice.Templates.invoice_entry,events:{"click #show-invoice":"showInvoice","click #delete-invoice":"deleteInvoice"},initialize:function(){},render:function(){this.model.fetchRelated(),console.log(this.model.getRelation("employee")),console.log(this.model.getRelation("client")),console.log(this.model);var a={invoice:this.model.toJSON()};return this.$el.html(this.template(a)),this},showInvoice:function(a){a.preventDefault(),this.trigger("show:invoice",this.model)},deleteInvoice:function(a){a.preventDefault(),this.trigger("delete:invoice",this.model)}});var app=app||{models:{},collections:{},views:{}};app.views.Invoices=Backbone.View.extend({el:"#invoices",template:invoice.Templates.invoice_list,events:{"click #new-invoice":"newInvoice","click #add-invoice":"addInvoice"},initialize:function(a){this.parent=a.parent,console.log("init"),this.collection.on("add",this.render,this),this.collection.on("remove",this.render,this),this.collection.on("reset",this.render,this),this.collection.fetch({reset:!0})},render:function(){return this.$el.html(this.template()),this.collection.each(function(a){this.renderInvoice(a)},this),this},renderInvoice:function(a){var b=new app.views.InvoiceEntry({model:a});console.log("rendering invoice"),this.listenTo(b,"show:invoice",this.showInvoice),this.listenTo(b,"delete:invoice",this.deleteInvoice),this.$el.find("tbody").append(b.render().el)},showInvoice:function(a){var b=new app.views.Invoice({model:a,parent:this.parent});this.listenTo(b,"show:invoices",this.showList),this.$el.find("#show-invoice-container").html(b.render().el),this.hideList()},hideList:function(){this.$el.find("#list-invoice-container").hide()},showList:function(){this.$el.find("#list-invoice-container").show(),this.render()},newInvoice:function(a){a.preventDefault();var b=invoice.Templates.invoice_new;this.$el.find("#new-invoice-container").html(b({contacts:this.parent.contacts.toJSON()})),$(".datepicker").datepicker()},addInvoice:function(a){a.preventDefault(),console.log("add invoice");var b={};$("#add-invoice-form").find("input").each(function(a,c){""!==$(c).val&&(b[c.id]=$(c).val()),$(c).val("")}),b.status="pending",console.log(b);var c=$("#employeeId").find(":selected").val(),d=$("#clientId").find(":selected").val(),e=new app.models.Invoice(b),f=this.parent.contacts.get(c),g=this.parent.contacts.get(d);console.log(f.attributes._id),console.log(g.attributes._id),e.set({employee:f.attributes._id,client:g.attributes._id}),this.collection.create(e)},deleteInvoice:function(a){a.destroy(),this.collection.remove(a)}});var app=app||{models:{},collections:{},views:{}};app.views.Service=Backbone.View.extend({tagName:"tr",template:invoice.Templates.service_entry,events:{"click #edit-service":"editService","click #save-service":"saveService","click #delete-service":"deleteService","click #cancel-edit-service":"cancelEdit"},initialize:function(){this.model.on("change",this.render,this),this.model.on("update:cost",this.render,this)},render:function(){return this.$el.empty(),this.$el.html(this.template(this.model.toJSON())),this},editService:function(a){a.preventDefault();var b=invoice.Templates.service_edit;this.$el.html(b(this.model.toJSON()))},saveService:function(a){a.preventDefault(),console.log("save service");var b={};$("#edit-service-form").find("input").each(function(a,c){""!==$(c).val&&(b[c.id]=$(c).val())}),this.model.set(b),this.model.updateCost()},deleteService:function(a){a.preventDefault(),this.trigger("delete:service",this.model)},cancelEdit:function(a){a.preventDefault(),this.render()}});var app=app||{models:{},collections:{},views:{}};app.views.Services=Backbone.View.extend({template:invoice.Templates.service_list,initialize:function(a){this.parent=a.parent,this.collection.on("add",this.render,this),this.collection.on("remove",this.render,this),this.render()},render:function(){return this.$el.html(this.template()),this.collection.each(function(a){this.renderService(a)},this),this},renderService:function(a){var b=new app.views.Service({model:a});this.listenTo(b,"delete:service",this.deleteService),this.$el.find("tbody").append(b.render().el)},deleteService:function(a){this.collection.remove(a)}});var app=app||{models:{},collections:{},views:{}};app.views.AppView=Backbone.View.extend({initialize:function(){this.invoices=new app.collections.Invoices,this.contacts=new app.collections.Contacts,this.invoiceView=new app.views.Invoices({parent:this,collection:this.invoices}),this.contactView=new app.views.Contacts({collection:this.contacts})}}),$(function(){new app.views.AppView});
//# sourceMappingURL=invoice.min.map.js